// This advanced hunting query detects CISA Known Exploited Vulnerabilities (KEV) based on the current catalog
// CISA KEV Catalog https://www.cisa.gov/known-exploited-vulnerabilities-catalog
//
// Grab the current CISA KEV list, create a variable
let CISAkev= externaldata(cveID:string)
                   ["https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv"]
                   with(format="csv");
DeviceTvmSoftwareVulnerabilitiesKB
| where CveId in(CISAkev)
| join kind=inner (
    DeviceTvmSoftwareVulnerabilities
    | join kind=inner DeviceInfo on $left.DeviceId == $right.DeviceId
) on CveId
// Project the column fields we care about
| project 
    MachineGroup,
    DeviceName,
    OSPlatform,
    OSVersion,
    SoftwareVendor,
    SoftwareName,
    SoftwareVersion,
    CveId,
    CvssScore,
    VulnerabilitySeverityLevel,
    IsExploitAvailable,
    VulnerabilityDescription,
    RecommendedSecurityUpdate,
    RecommendedSecurityUpdateId,
    PublishedDate,
    LastModifiedTime
| distinct *
// Sort Output by MachineGroup
| sort by MachineGroup asc
